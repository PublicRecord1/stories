<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Your Story</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f9;
        }
        h1 {
            color: #333;
        }
        .button {
            padding: 15px 25px;
            font-size: 18px;
            color: white;
            background-color: #FF5500;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .button:hover {
            background-color: #FF4200;
        }
        .instructions {
            font-size: 18px;
            margin: 20px 0;
            line-height: 1.6;
        }
        #audio-controls {
            margin: 20px;
        }
        .qr-container {
            margin-top: 30px;
            text-align: center;
        }
        .qr-container img {
            width: 200px;
            margin: 10px auto;
        }
        .qr-container p {
            font-size: 18px;
            margin-top: 10px;
            color: #333;
        }
    </style>
</head>
<body>

    <h1>Record and Download Your Story</h1>
    <p class="instructions">
        The Public Records <br><br>
        We would like you to close your eyes and think about the ways that climate change manifests in your life. 
        Put yourself back into that specific moment in time when you had a realization about the climate crisis and how it impacted you. 
        Describe what you see in detail. 
        <br><br>
        Where were you? <br>
        What was happening? <br><br>
        Think about your own personal responses to climate change. 
        Can you give an example of how you have failed to respond to the climate crisis? 
        Conversely, can you describe how you have effectively responded to climate change? 
        <br><br>
        Imagine that you are a historian from the future looking back to this moment of time, trying to understand the socio-environmental trauma of the era. 
        <br>
        What is important to remember from this moment in time? 
        <br>
        What would you want New Yorkers of 2025 to understand and act on regarding climate change? 
        <br><br>
        Click the button below to start recording your voice directly on this page!
    </p>

    <!-- Record/Stop buttons -->
    <div id="audio-controls">
        <button class="button" id="start-recording" onclick="startRecording()">Start Recording</button>
        <button class="button" id="stop-recording" onclick="stopRecording()" style="display: none;">Stop Recording</button>
        <button class="button" id="play-audio" onclick="playAudio()" style="display: none;">Play Recording</button>
        <button class="button" id="submit-audio" onclick="downloadAudio()" style="display: none;">Submit Audio</button>
    </div>

    <p class="instructions">Once you're done, you can download the recording to save it on the iPad.</p>

    <!-- QR Code Section -->
    <div class="qr-container">
        <img src="frame (3).png" alt="QR Code">
        <p>Record and submit by phone instead</p>
    </div>
    
    <!-- Recorder.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recorderjs/0.1.0/recorder.js"></script>

    <script>
        let recorder; // Recorder instance
        let audioData; // Blob of the recorded audio

        // Start recording function
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function (stream) {
                    const audioContext = new AudioContext();
                    const input = audioContext.createMediaStreamSource(stream);
                    recorder = new Recorder(input);
                    recorder.record();
                    document.getElementById('start-recording').style.display = 'none';
                    document.getElementById('stop-recording').style.display = 'inline-block';
                })
                .catch(function (err) {
                    alert('Microphone access is required to record audio.');
                    console.error(err);
                });
        }

        // Stop recording function
        function stopRecording() {
            recorder.stop();
            recorder.exportWAV(function (blob) {
                audioData = blob;
                document.getElementById('stop-recording').style.display = 'none';
                document.getElementById('play-audio').style.display = 'inline-block';
                document.getElementById('submit-audio').style.display = 'inline-block';
            });
        }

        // Play the recorded audio
        function playAudio() {
            const audioURL = URL.createObjectURL(audioData);
            const audio = new Audio(audioURL);
            audio.play();
        }

        // Download the audio file without opening a new tab
        function downloadAudio() {
            const audioURL = URL.createObjectURL(audioData);
            const link = document.createElement('a');
            link.href = audioURL;
            link.download = 'recording.wav'; 
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link); // Clean up the link element
        }
    </script>

</body>
</html>
